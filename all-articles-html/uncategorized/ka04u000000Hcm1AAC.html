<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script to update XML to use FSAA for control DeletedUSN</title>
    <meta name="article-id" content="ka04u000000Hcm1AAC">
    <meta name="articlecaseattachcount" content="0">
    <meta name="articlecreatedbyid" content="0054u000006god6AAA">
    <meta name="articlecreateddate" content="2022-02-01T18:23:09.000Z">
    <meta name="articlenumber" content="000006598">
    <meta name="createdbyid" content="0054u000006god6AAA">
    <meta name="createddate" content="2023-05-08T10:06:20.000Z">
    <meta name="firstpublisheddate" content="2022-02-01T18:23:09.000Z">
    <meta name="islatestversion" content="true">
    <meta name="knowledgearticleid" content="kA04u0000000IOUCA2">
    <meta name="knowledge-article-id" content="kA04u0000000IOUCA2">
    <meta name="lastmodifiedbyid" content="0054u000006gSmgAAE">
    <meta name="lastmodifieddate" content="2023-05-08T10:06:20.000Z">
    <meta name="lastpublisheddate" content="2022-02-01T18:23:09.000Z">
    <meta name="meta-description" content="360008408371">
    <meta name="meta-title" content="Script to update XML to use FSAA for control DeletedUSN">
    <meta name="ownerid" content="0054u000006god6AAA">
    <meta name="recordtypeid" content="0124u000000UUgLAAW">
    <meta name="urlname" content="6598">
    <meta name="versionnumber" content="1">
    <meta name="website-url" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA04u0000000IOUCA2.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>Script to update XML to use FSAA for control DeletedUSN</h1>
    <p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> Hotfix for SAFS-806 requires you to update every job XML for every FS scan and bulk import. Depending on the environment this can be very time consuming. Below you will find a PowerShell Script to automate this process.</p>
<p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> <span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;"><strong>Issue:</strong> ��</span></span><span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;"><span style="color: black;">The hotfixes based on Sb Dev ticket </span>SAFS-806 (listed below) <span style="color: black;">requires that every job XML for every FS scan and bulk import be updated to add the USEFSAAFORDELTED tag.� Depending on the environment, this can be very time consuming.�</span><br><br><span style="color: black;">8.2_003:�<a style="text-decoration: underline;color: #0563c1;" href="https://na55.salesforce.com/articles/General/Hotfix-SA-8-2-003" target="_blank">https://na55.salesforce.com/articles/General/Hotfix-SA-8-2-003</a></span><br><span style="color: black;">8.1_109:�<a style="text-decoration: underline;color: #0563c1;" href="https://na55.salesforce.com/articles/General/Hotfix-SA-8-1-109" target="_blank">https://na55.salesforce.com/articles/General/Hotfix-SA-8-1-109</a></span><br><span style="color: black;">8.0_099:�<a style="text-decoration: underline;color: #0563c1;" href="https://na55.salesforce.com/articles/General/Hotfix-SA-8-0-099" target="_blank">https://na55.salesforce.com/articles/General/Hotfix-SA-8-0-099</a></span><br><span style="color: black;">7.2 SP1_085:�<a style="text-decoration: underline;color: #0563c1;" href="https://na55.salesforce.com/articles/General/Hotfix-SA-7-2-SP1-085" target="_blank">https://na55.salesforce.com/articles/General/Hotfix-SA-7-2-SP1-085</a></span></span></span></p>
<p><br><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> <span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;"><strong>Instructions:</strong>� If performing this in StealthAUDIT 8.1 - 9.0 it is recommended to make these changes through the View XML option in the bottom left of Query Properties as this will enable the changes to be recorded and carried over during an upgrade.� The PowerShell script below will make the changes directly to the job XML. Known caveats related to the procedure are below:</span></span></p>
<ul><li><span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;">All changes will be lost during an upgrade, for any jobs based on out-of-the-box jobs.</span></span></li><li><span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;">Jobs with multiple queries are supported, but both queries cannot use FSAA (which should be rare outside a lab environment).</span></span></li><li><span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;">PowerShell needs to be run as administrator.</span></span></li><li><span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;">Any changes made while jobs are running will be overwritten when the job completes.</span></span></li></ul>
<p><span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span style="color: darkgreen;">#gets valid job XMLs, excluding those where the Job value doesn&#39;t match the folder name, where the xml is in a group or job path that doesn&#39;t start with GROUP_ or JOB_, respectively.<br>if ($Host.version.Major -gt 2){$emptyArrayValue=0} else {$emptyArrayValue=$null}<br>$Jobs=$(cmd /c dir /b $(&quot;$Env:SAInstallDir&quot;+&quot;Jobs&quot;) /s ) | ?{<br>$(($_[($_.LastIndexOf(&#39;\&#39;)+1)..$_.length]) -join(&#39;&#39;) -replace(&#39;.xml&#39;,&#39;&#39;)) -eq $(($_[0..($_.LastIndexOf(&#39;\&#39;)-1)] -join(&#39;&#39;))[(($_[0..($_.LastIndexOf(&#39;\&#39;)-1)] -join(&#39;&#39;)).lastindexof(&#39;\&#39;)+1)..($_[0..($_.LastIndexOf(&#39;\&#39;)-1)] -join(&#39;&#39;)).length] -join(&#39;&#39;))`<br>-and ($_[($_.LastIndexOf(&#39;\&#39;)+1)..$_.length]) -join(&#39;&#39;) -replace(&#39;.xml&#39;,&#39;&#39;) -like &#39;JOB_*&#39; `<br>-and $($($_[($_.indexof(&#39;\StealthAUDIT\Jobs\&#39;)+19)..($_.LastIndexOf(&#39;\&#39;)-1)]) -join(&#39;&#39;) -split(&#39;\\&#39;) | ?{$_ -notlike &#39;JOB_*&#39; -and $_ -notlike &#39;GROUP_*&#39;}).length -eq $EmptyArrayValue}<br>$Res=@()<br>foreach ($JobXML in $Jobs)<br>{<br>� � $out=&#39;&#39; | select &#39;Date&#39;, &#39;JobXMLPath&#39;, &#39;IsFSAA&#39;, &#39;AddOrUpdate&#39;<br>� � $out.JobXMLPath=$JobXML<br>� � [XML]$Job=get-content $JobXML<br>� � $Out.Date=get-date -format yyyy-MM-dd_HH-mm-ss.fff<br>� � if($Job.Job.Partitions.Partition.Tasks.Task.Settings.Source -eq &#39;FILESYSTEMACCESS&#39; -and (&#39;scanFileSystemAccessPartial&#39;,&#39;bulkImportFileSystemAccess&#39;,&#39;scanFileSystemActivity&#39;,&#39;bulkImportFileSystemActivity&#39;,&#39;scanDLP&#39;,&#39;bulkImportDLP&#39;) -contains $Job.Job.Partitions.Partition.Tasks.Task.ROOTS.root.name )<br>� � {#this is an applicable FSAA query (doesn&#39;t include maintenance or DFS queries)<br>� � � �$out.IsFSAA=&#39;True&#39;<br>� � � � � � if(select-string -path $JobXML -pattern &#39;False&#39;,&#39;True&#39;)<br>� � � � � � {#value exists - make sure it&#39;s set to True<br>� � � � � � � � $Out.AddOrUpdate=&#39;Update&#39;<br>� � � � � � � � ((get-content $JobXML) -replace(&#39;False&#39;,&#39;True&#39;)) | set-content $JobXML<br>� � � � � � }<br>� � � � � � else<br>� � � � � � {#value does not exist - add it at the end of the FSAA Settings node<br>� � � � � � � � $Out.AddOrUpdate=&#39;Add&#39;<br>� � � � � � � � ((get-content $JobXML) -replace(&#39;&#39;,&#39;True&#39;)) | set-content $JobXML<br>� � � � � � }<br>� � � ��<br>� � }<br>� � else<br>� � {<br>� � � � $Out.IsFSAA=&#39;False&#39;<br>� � � � $Out.AddOrUpdate=&#39;N/A&#39;<br>� � }<br>� � $Res+=$Out<br>}<br>$Res</span></span></span></span><br><br><span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;">Attached is a StealthAUDIT job to execute this.� Set the Host to local host and execute.� If running this in StealthAUDIT 8.1 - 9.0 I would recommend adding this to a Post-Upgrade Job group with FS Migration to run after upgrading.</span></span><br><br><a href="https://downloads.stealthbits.com/access/files/StealthTOOLS/AUDIT/JOB_UseFSAADelete.zip" target="_blank">https://downloads.stealthbits.com/access/files/StealthTOOLS/AUDIT/JOB_UseFSAADelete.zip</a></p>
<p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthAUDIT<br><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - DC - FSAA - Permissions<br><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> 7.2, 8.0, 8.1, 8.2, 9.0<br><strong><span class="wysiwyg-font-size-large">Dev Ticket:</span></strong> SAFS-806<br><strong><span class="wysiwyg-font-size-large">Resolved In:</span></strong> Official fix is pending delivery in StealthAUDIT 10.0; the USEFSAAFORDELETE option is only available starting with the following versions: 7.2 SP1: - DCFSAA.dll 7.2.766 - FSAASrv.dll 7.2.766 8.0: - DCFSAA.dll 8.0.852 - FSAASrv.dll 8.0.852 8.1 - DCFSAA.dll 8.1.989 - FSAASrv.dll 8.1.989 8.2 - DCFSAA.dll 8.2.1038 - FSAASrv.dll 8.2.1038 9.0 - GA and later<br><strong><span class="wysiwyg-font-size-large">Salesforce Article ID:</span></strong> 000002491</p>
</body>
</html>