<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSAA doesn&#x27;t mark all children as Deleted.</title>
    <meta name="article-id" content="ka04u000000HczZAAS">
    <meta name="articlecaseattachcount" content="0">
    <meta name="articlecreatedbyid" content="0054u000006god6AAA">
    <meta name="articlecreateddate" content="2022-02-01T18:44:52.000Z">
    <meta name="articlenumber" content="000007382">
    <meta name="createdbyid" content="0054u000006god6AAA">
    <meta name="createddate" content="2023-05-08T10:12:58.000Z">
    <meta name="firstpublisheddate" content="2022-02-01T18:44:53.000Z">
    <meta name="islatestversion" content="true">
    <meta name="knowledgearticleid" content="kA04u0000000IyRCAU">
    <meta name="knowledge-article-id" content="kA04u0000000IyRCAU">
    <meta name="lastmodifiedbyid" content="0054u000006gSmgAAE">
    <meta name="lastmodifieddate" content="2023-05-08T10:12:58.000Z">
    <meta name="lastpublisheddate" content="2022-02-01T18:44:53.000Z">
    <meta name="meta-description" content="360008408371">
    <meta name="meta-title" content="FSAA doesn&#x27;t mark all children as Deleted.">
    <meta name="ownerid" content="0054u000006god6AAA">
    <meta name="recordtypeid" content="0124u000000UUgLAAW">
    <meta name="urlname" content="7382">
    <meta name="versionnumber" content="1">
    <meta name="website-url" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA04u0000000IyRCAU.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>FSAA doesn&#x27;t mark all children as Deleted.</h1>
    <p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> There is a known issue in FSAA where it&#39;s possible not all children will be marked as deleted.</p><p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> There is a known issue in FSAA where it&#39;s possible not all children will be marked as deleted.<br>Following example will reproduce issue:<br><i><span style="color: #404040;">Parent folder picked up in permission scan. Child folder was created and picked up during activity scan. Deleted parent and child folder. Subsequent permission scan only marks parent as deleted.</span></i><br><i><span style="color: #404040;">The cause is that there are resources in activity that were collected that were not collected by permission scans. </span></i><br>�</p><p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> <b>Workaround:</b><br>The following script can be used to mark children of deleted parents as deleted: 
</p><div>
<span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">IF NOT EXISTS </span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">(</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����SELECT </span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">*</span></span></span>�<br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����FROM sys</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">indexes </span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����WHERE name</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">=</span></span></span><span style="color: #008800;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">&#39;SA_FSAA_Resources_DeletedUSN_IDX&#39;</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����AND object_id </span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;"> OBJECT_ID</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">(</span></span></span><span style="color: #008800;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">&#39;SA_FSAA_Resources&#39;</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">)</span></span></span><br>����<span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">)</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����CREATE INDEX SA_FSAA_Resources_DeletedUSN_IDX </span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����ON SA_FSAA_Resources </span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">(</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">HOST</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">,</span></span></span> <span style="color: #660066;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">DeletedUSN</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">)</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����WHERE </span></span></span><span style="color: #660066;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">DeletedUSN</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;"> IS NOT NULL</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">;</span></span></span><br><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">START</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">:</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����UPDATE r</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����SET r</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">.</span></span></span><span style="color: #660066;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">DeletedUSN</span></span></span> <span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;"> r2</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">.</span></span></span><span style="color: #660066;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">DeletedUSN</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����FROM SA_FSAA_Resources r</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����JOIN SA_FSAA_Resources r2</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����ON r</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">.</span></span></span><span style="color: #660066;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">ParentResourceID</span></span></span> <span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;"> r2</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">ID</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����AND r</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">HOST </span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;"> r2</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">HOST</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����WHERE r2</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">.</span></span></span><span style="color: #660066;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">DeletedUSN</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;"> IS NOT NULL</span></span></span><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">����AND r</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">.</span></span></span><span style="color: #660066;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">DeletedUSN</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;"> IS NULL</span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">;</span></span></span><br><br><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">IF </span></span></span><span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">@</span></span></span><span style="color: #006666;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">@ROWCOUNT</span></span></span> <span style="color: #666600;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;"></span></span> <span style="color: #006666;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;">0</span></span></span><span style="color: black;"><span style="font-family: courier new;"><span style="font-size: 10.5pt;"> GOTO START</span></span></span>
</span></div>In the case that those resources are recreated and activity is collected for them, they will remain marked as deleted until an FSAA scan is run again and detects that the resource is no longer deleted. If an FSAA scan doesn&#39;t reach that depth, then the resource will remain deleted. In the case that FSAC is run more often than FSAA or FSAA isn&#39;t run at full depth (including file-level scans), this can result in activity being hidden from the user because reports will ignore the activity for deleted resources.<br>�<p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthAUDIT<br><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - DC - FSAA - Activity;SA - DC - FSAA - DFS;SA - DC - FSAA - Permissions;SA - DC - FSAA - Sensitive Data<br><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> 7.1+<br><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 2025<br></p>
</body>
</html>