<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Override DFS targets</title>
    <meta name="article-id" content="ka04u000000HckVAAS">
    <meta name="articlecaseattachcount" content="0">
    <meta name="articlecreatedbyid" content="0054u000006god6AAA">
    <meta name="articlecreateddate" content="2022-02-01T18:34:58.000Z">
    <meta name="articlenumber" content="000007219">
    <meta name="createdbyid" content="0054u000006god6AAA">
    <meta name="createddate" content="2023-05-08T10:05:34.000Z">
    <meta name="firstpublisheddate" content="2022-02-01T18:34:58.000Z">
    <meta name="islatestversion" content="true">
    <meta name="knowledgearticleid" content="kA04u0000000IK8CAM">
    <meta name="knowledge-article-id" content="kA04u0000000IK8CAM">
    <meta name="lastmodifiedbyid" content="0054u000006gSmgAAE">
    <meta name="lastmodifieddate" content="2023-05-08T10:05:34.000Z">
    <meta name="lastpublisheddate" content="2022-02-01T18:34:58.000Z">
    <meta name="meta-description" content="360008408371">
    <meta name="meta-title" content="Override DFS targets">
    <meta name="ownerid" content="0054u000006god6AAA">
    <meta name="recordtypeid" content="0124u000000UUgLAAW">
    <meta name="urlname" content="7219">
    <meta name="versionnumber" content="1">
    <meta name="website-url" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA04u0000000IK8CAM.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>Override DFS targets</h1>
    <p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> Client wanted to force DFS scanning to target servers in a specific geographic location, however StealthAUDIT often just grabs any available target path. This workflow allows SA to query customer environment for available target paths for a DFS share, and then overwrite our standard query&#39;s targets.</p>
<p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> DFS Folder targets are picked indiscriminately, with no recourse for a user to override those targets.� Examples include a target preference or a geographic preference by client.</p>
<p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> Out of the box, SA will query a DC for name spaces, folder targets, and paths for any given DFS setup.� It will then pick one target indiscriminately amongst available target paths for a folder.� However, there may be situations where a customer may wish to use a specific path, one that SA did not choose.� (Similar to the way a customer may elect for a different DC than what the Dynamic Host List &#39;Default Domain Controller&#39; chose.)</p>
<p><br>We&#39;ll use a single Namespace here, with two folders:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000Lcaa8&amp;d=%2Fa%2F4u000000Lyil%2F0xPvnMePrLneRap8xnMhqDAB5gzyyyFjNLk7s.ErxqE&amp;asPdf=false" alt="mceclip0.png"></img></p>
<p>The two folders have multiple targets with full replication set up between them.� (This PS query will be turned into a job later.)<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LcaXK&amp;d=%2Fa%2F4u000000Lyvg%2FX5OkmDXE_u9_q.s.naU7K3uZoI6lUBiacx0OXLP587Q&amp;asPdf=false" alt="mceclip1.png"></img><br>�<br>Without modification, here is the result within SA after running the &quot;0-FSDFS System Scans&quot; job:<br>Two of the three hosts made it to the DFS Host List:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LcVa3&amp;d=%2Fa%2F4u000000Lyvl%2Fe4w9Mb7emaMzegdvw9K6QEN1ImMIM7IMj_1D2DlSDoQ&amp;asPdf=false" alt="mceclip2.png"></img><br>�<br>If we query the <span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">[SA_FSDFS_Links]</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> table we can see some details of which paths were picked (some columns omitted for space):</span></span></span><br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LcWz0&amp;d=%2Fa%2F4u000000Lyvq%2FjjVxqDDiA4aY69PjA4LWfDBiliJE6l8iqyU_ri0v9mg&amp;asPdf=false" alt="mceclip3.png"></img><br>�<br>But take a look at the results of the PS query again.� Notice in the <em>ReferralPriorityClass</em> column that one of the targets for \DFSFolder has a value of <em>global-high</em>.� This is due to a DFS configuration option available to admins that is not considered in our current target selection:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LcaaD&amp;d=%2Fa%2F4u000000Lyvv%2FjEhYAYw3rdQ9EC2devL8paMuLpS1VsO_x_ydftUqFmo&amp;asPdf=false" alt="mceclip4.png"></img></p>
<p>The host TATOOINE is not set to be scanned at all, as evident by its absence in our DFS host list.<br>�<br><strong>In order to override these targets, we will use PS to query all DFS folder target paths into a table, and then insert them into the appropriate SA tables before the host lists are created.</strong><br>�<br>The first step is to create a job that will query and create our table of possible targets.� 1 query, No analysis or actions.� Name something sensible, as you will reference the _DEFAULT table later.�� Create a new query with the POWERSHELL data collector, default settings for all config pages should be fine.� Use the following for the query:<br><span style="font-family: courier new;">$roots=Get-DfsnRoot | Select-Object -ExpandProperty path</span><br><span style="font-family: courier new;">foreach ($root in $roots){</span><br><span style="font-family: courier new;">Get-DfsnFolder -Path ($root+&quot;\*&quot;) | Get-DfsnFolderTarget</span><br><span style="font-family: courier new;">}</span><br>�<br>Be sure to set a host, in most cases local host will work fine.� The results should be the same as above:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LcaaI&amp;d=%2Fa%2F4u000000Lyw0%2F_KGnfJw9Riq65enpSanngMkAHfvpEIxU7WIXTdmY9qg&amp;asPdf=false" alt="mceclip5.png"></img></p>
<p>Next, create a new analysis inside of the &quot;0-DFS System Scan&quot; job.� Name it something that will catch the eye of future engineers as being custom work in an out-of-the-box solution if possible.� You must bring the new analysis to the top of the list; it <strong>must</strong> run before the other two:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LcaaN&amp;d=%2Fa%2F4u000000Lyw5%2FF1ZTDjCF4b.ysvybqEFQ.bZv1Wsg1mwNdUBUEfFRP2s&amp;asPdf=false" alt="mceclip6.png"></img></p>
<p>The analysis should be a simple update statement to the DF<br><span style="font-family: courier new;">UPDATE [dbo].[SA_FSDFS_Links]</span><br><span style="font-family: courier new;">SET [TargetPath] = o.[TargetPath]</span><br><span style="font-family: courier new;">FROM [dbo].[SA_FSDFS_Links] d</span><br><span style="font-family: courier new;">LEFT JOIN [dbo].[SA_DFS_Override_DEFAULT] o</span><br><span style="font-family: courier new;">ON LOWER(d.[DfsPath]) = LOWER(o.[Path])</span><br><span style="font-family: courier new;">AND/WHERE . . . </span><br>�<br><strong><em><span style="color: red;">Here is where you must consider your customer&#39;s needs to complete the query.� Maybe the want to target the priority targets, maybe they want to avoid them.� Maybe they do not have priorities set at all but still want all scans on a specific Geographic location.� This, as well as the path names themselves will shape the rest of the query.</span></em></strong><br>You will also need to update the [TargetHostId] column with the correct ID for changes made.� These IDS can be found on the <span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">[SA_FSAA_Hosts]</span></span></span> table.� (If you are looking to include a host that is not currently there, it will need to be added.� A quick zero-level scan will add it as well as test connection/permissions.)� The following query should update any changes, but always double check:<br><span style="font-family: courier new;">UPDATE [dbo].[SA_FSDFS_Links]</span><br><span style="font-family: courier new;">SET [TargetHostID] = h.[ID]</span><br><span style="font-family: courier new;">FROM [dbo].[SA_FSDFS_Links] d</span><br><span style="font-family: courier new;">LEFT JOIN [dbo].[SA_FSAA_Hosts] h</span><br><span style="font-family: courier new;">ON h.[HOST] = SUBSTRING(d.[TargetPath],3,CHARINDEX(&#39;\&#39;,d.[TargetPath],3)-3)</span><br><span style="font-family: courier new;">WHERE [TargetHostID] <br>�<br>In our example, I am looking for a single change where I have a global preference set.� I have also chosen to surface the [SA_FSDFS_Links] table here so that I can more easily reference the results:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LcaaS&amp;d=%2Fa%2F4u000000LywA%2FuKrgkMa41WH3wa0MjSu88PM_HRhARJvruP44kgsi27M&amp;asPdf=false" alt="mceclip7.png"></img></span></p>
<p>Running the &quot;0-DFS System Scan&quot; job again, we can then see our results:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LcaaX&amp;d=%2Fa%2F4u000000Lyhq%2FEqJyQOJngkM01_liXCoit6tCSWqu_F6Iv3ZySmQr8po&amp;asPdf=false" alt="mceclip8.png"></img></p>
<p>The &#39;DFSFolder&#39; target now reflects the change, as does the host ID.� Our DFS Host list now contains 3 hosts, and when a scan is initiated against the host list it will scan TATOOINE instead of CORUSCANT as it would have previously:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000Lcaah&amp;d=%2Fa%2F4u000000Lyrl%2FqAJVT3J1hr0Xqq2eI.ymfalnCYHcjylRIY1T0s2.HSo&amp;asPdf=false" alt="mceclip9.png"></img><br>�<br>As an alternate example, HOTH is a geographic location known for ice storms that lead to poor network connectivity.� If the customer wished to avoid scanning HOTH, and it is known that all DFS targets on HOTH are always replicated to TATOOINE, we may craft our SQL statement differently:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LcZtZ&amp;d=%2Fa%2F4u000000Lyi2%2FbDM6N4ZVNmTtlKrR61LA0e0d8LbalSwhwYeXQx_rPSE&amp;asPdf=false" alt="mceclip10.png"></img><br>�<br>This will lead to a result as such:<br><img src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000Lcaam&amp;d=%2Fa%2F4u000000LywF%2FvdXuu9P0AVQnLRBBARvbmgPOzN_sr9AIpyCOaBzzB7E&amp;asPdf=false" alt="mceclip11.png"></img></p>
<p>And HOTH will be ignored for any DFS scoped scans.<br><br></p>
<p>�</p>
<p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthAUDIT<br><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - DC - FSAA - DFS<br><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> 8.1<br><strong><span class="wysiwyg-font-size-large">Dev Ticket:</span></strong> Not directly related, however DFS scoping must be fixed as per https://na55.salesforce.com/500f100000jWiqE and subsequent article https://na55.salesforce.com/kA0f1000000oNWT . Article should remain relevant after those fixes are released.<br><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 2152</p>
</body>
</html>