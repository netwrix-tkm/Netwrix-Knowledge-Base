<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mongo Commands - Template Upgrade Process: When Upgrading to R2 7.1.0.18 and Newer</title>
    <meta name="article-id" content="ka04u000000HdBBAA0">
    <meta name="articlecaseattachcount" content="0">
    <meta name="articlecreatedbyid" content="0054u000006god6AAA">
    <meta name="articlecreateddate" content="2022-02-07T00:59:55.000Z">
    <meta name="articlenumber" content="000008298">
    <meta name="createdbyid" content="0054u000006god6AAA">
    <meta name="createddate" content="2023-05-08T10:18:17.000Z">
    <meta name="firstpublisheddate" content="2022-02-07T00:59:55.000Z">
    <meta name="islatestversion" content="true">
    <meta name="knowledgearticleid" content="kA04u0000000JffCAE">
    <meta name="knowledge-article-id" content="kA04u0000000JffCAE">
    <meta name="lastmodifiedbyid" content="0054u000006gSmgAAE">
    <meta name="lastmodifieddate" content="2023-05-08T10:18:17.000Z">
    <meta name="lastpublisheddate" content="2022-02-07T00:59:55.000Z">
    <meta name="meta-description" content="HELPDESK">
    <meta name="meta-title" content="Mongo Commands - Template Upgrade Process: When Upgrading to R2 7.1.0.18 and Newer">
    <meta name="ownerid" content="0054u000006god6AAA">
    <meta name="recordtypeid" content="0124u000000UUgLAAW">
    <meta name="urlname" content="8298">
    <meta name="versionnumber" content="1">
    <meta name="website-url" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA04u0000000JffCAE.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>Mongo Commands - Template Upgrade Process: When Upgrading to R2 7.1.0.18 and Newer</h1>
    <p>-Rationalisation a few of the report template names, so they&#39;re now a more consistent set of Detail and Summary (eg &#39;Device Detail&#39; and &#39;Device Summary&#39;), but this means a bit of one-off manual mongo work at the point of upgrade from earlier versions - <strong>*** See the bottom of this email for details.</strong></p><p><br></p><p><strong>Template Upgrade Process</strong></p><p><strong>Note - </strong></p><p><strong>These commands are only relevant when upgrading from Change Tracker R2 <strong>7.1.0.14,�<strong>7.1.0.15,�</strong></strong>7.1.0.16 and 7.1.0.17. </strong></p><p><strong>it is important to run the mongo update commands before the new R2 7.2.1.18 starts up for the first time after install (i.e. don&#39;t forget to stop IIS)</strong></p><p><strong>If you do run the command without IIS being stopped, Change Tracker will survive although any report running at the time might be impacted. Reports will however recover.</strong></p><p><br></p><p>To rename the templates:</p><ol><li>Stop IIS</li><li>Delete ALL report templates *.json files from�<strong>C:\inetpub\wwwroot\Change Tracker Generation 7 Hub\bin\Setup\ReportTemplates</strong></li><li><strong>Install the new version </strong>7.2.1.18</li><li><strong>Run the </strong><strong>script below�</strong>to rename the templates in Mongo - note this can be pasted en-masse into the mongo shell. (Take a copy of the full-text result of running each command for later diagnostics)</li><li>Start IIS</li><li>There should be only one template of each &#39;Report Name&#39; listed in the <strong>second</strong> column of the grid on Settings &gt; Report Layout Templates page</li><li>On the�Settings &gt; Report Layout Templates page, there will be various Updated templates available - <strong>Click &#39;Update Template&#39; on each</strong></li></ol><p><br></p><p>// Report layout template names have been rationalised in 7.2.1.17</p><p>// Run these queries to update existing records before allowing the 7.2.1.17 IIS application to startup for the first time</p><p>// ====================================================================================================================</p><p><br></p><p>use NNTHubService</p><p><br></p><p>// Compliance Full -&gt; Compliance Detail</p><p><br></p><p>// Find the number of Compliance Full Templates being used.</p><p>db.ReportData.find({&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Compliance Full&#39;}).count()</p><p><br></p><p>// Update the Template Name</p><p>db.ReportData.update({&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Compliance Full&#39;}, { $set: {&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Compliance Detail&#39;} }, { multi: true })</p><p><br></p><p>// Find the number of Compliance Detail Templates being used</p><p>db.ReportData.find({&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Compliance Detail&#39;}).count()</p><p><br></p><p><br></p><p>// Planned Change Instance -&gt; Planned Change Detail</p><p><br></p><p>// Find the number of Compliance Full Templates being used.</p><p>db.ReportData.find({&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Planned Change Instance&#39;}).count()</p><p><br></p><p>// Update the Template Name</p><p>db.ReportData.update({&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Planned Change Instance&#39;}, { $set: {&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Planned Change Detail&#39;} }, { multi: true })</p><p><br></p><p>// Find the number of Compliance Detail Templates being used</p><p>db.ReportData.find({&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Planned Change Detail&#39;}).count()</p><p><br></p><p><br></p><p>// Device Monitoring -&gt; Device Detail</p><p><br></p><p>// Find the number of Compliance Full Templates being used.</p><p>db.ReportData.find({&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Device Monitoring&#39;}).count()</p><p><br></p><p>// Update the Template Name</p><p>db.ReportData.update({&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Device Monitoring&#39;}, { $set: {&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Device Detail&#39;} }, { multi: true })</p><p><br></p><p>// Find the number of Compliance Detail Templates being used</p><p>db.ReportData.find({&#39;ScheduledReportItem.EmailDelivery.Attachment1TemplateName&#39;: &#39;Device Detail&#39;}).count()</p><p><br></p><p><br></p><p>// Updating the fs.files Report Template meta data</p><p>// ================================================</p><p><br></p><p>// Compliance Full -&gt; Compliance Detail</p><p><br></p><p>// Find the number of Compliance Full Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { &#39;filename&#39;: &#39;ComplianceFull.json&#39; }).count()</p><p>db.fs.files.find( { &#39;metadata.ReportTemplateName&#39;: &#39;Compliance Full&#39; }).count()</p><p><br></p><p>// Update the filename</p><p>db.fs.files.update({&#39;filename&#39;: &#39;ComplianceFull.json&#39;}, { $set: {&#39;filename&#39;: &#39;ComplianceDetail.json&#39;} }, { multi: true })</p><p>// Update the metadata</p><p>db.fs.files.update({&#39;metadata.ReportTemplateName&#39;: &#39;Compliance Full&#39;}, { $set: {&#39;metadata.ReportTemplateName&#39;: &#39;Compliance Detail&#39;} }, { multi: true })</p><p>db.fs.files.update({&#39;metadata.FileName&#39;: &#39;ComplianceFull.json&#39;}, { $set: {&#39;metadata.FileName&#39;: &#39;ComplianceDetail.json&#39;} }, { multi: true })</p><p><br></p><p>// Find the number of Compliance Detail Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { &#39;filename&#39;: &#39;ComplianceDetail.json&#39; }).count()</p><p>db.fs.files.find( { &#39;metadata.ReportTemplateName&#39;: &#39;Compliance Detail&#39; }).count()</p><p><br></p><p><br></p><p>// Planned Change Instance -&gt; Planned Change Detail</p><p><br></p><p>// Find the number of Planned Change Instance Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { &#39;filename&#39;: &#39;PlannedChangeInstance.json&#39; }).count()</p><p>db.fs.files.find( { &#39;metadata.ReportTemplateName&#39;: &#39;Planned Change Instance&#39; }).count()</p><p><br></p><p>// Update the filename</p><p>db.fs.files.update({&#39;filename&#39;: &#39;PlannedChangeInstance.json&#39;}, { $set: {&#39;filename&#39;: &#39;PlannedChangeDetail.json&#39;} }, { multi: true })</p><p>// Update the metadata</p><p>db.fs.files.update({&#39;metadata.ReportTemplateName&#39;: &#39;Planned Change Instance&#39;}, { $set: {&#39;metadata.ReportTemplateName&#39;: &#39;Planned Change Detail&#39;} }, { multi: true })</p><p>db.fs.files.update({&#39;metadata.FileName&#39;: &#39;PlannedChangeInstance.json&#39;}, { $set: {&#39;metadata.FileName&#39;: &#39;PlannedChangeDetail.json&#39;} }, { multi: true })</p><p><br></p><p>// Find the number of Planned Change Detail Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { &#39;filename&#39;: &#39;PlannedChangeDetail.json&#39; }).count()</p><p>db.fs.files.find( { &#39;metadata.ReportTemplateName&#39;: &#39;Planned Change Detail&#39; }).count()</p><p><br></p><p><br></p><p>// Device Monitoring -&gt; Device Detail</p><p><br></p><p>// Find the number of Device Monitoring Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { &#39;filename&#39;: &#39;DeviceMonitoring.json&#39; }).count()</p><p>db.fs.files.find( { &#39;metadata.ReportTemplateName&#39;: &#39;Device Monitoring&#39; }).count()</p><p><br></p><p>// Update the filename</p><p>db.fs.files.update({&#39;filename&#39;: &#39;DeviceMonitoring.json&#39;}, { $set: {&#39;filename&#39;: &#39;DeviceDetail.json&#39;} }, { multi: true })</p><p>// Update the metadata</p><p>db.fs.files.update({&#39;metadata.ReportTemplateName&#39;: &#39;Device Monitoring&#39;}, { $set: {&#39;metadata.ReportTemplateName&#39;: &#39;Device Detail&#39;} }, { multi: true })</p><p>db.fs.files.update({&#39;metadata.FileName&#39;: &#39;DeviceMonitoring.json&#39;}, { $set: {&#39;metadata.FileName&#39;: &#39;DeviceDetail.json&#39;} }, { multi: true })</p><p><br></p><p>// Find the number of Device Detail Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { &#39;filename&#39;: &#39;DeviceDetail.json&#39; }).count()</p><p>db.fs.files.find( { &#39;metadata.ReportTemplateName&#39;: &#39;Device Detail&#39; }).count()</p><p><br></p><p>// Sti Error Template -&gt; Error Template</p><p><br></p><p>// Find the number of Templates, filename and metadata counts should match</p><p>db.fs.files.find( { &#39;filename&#39;: &#39;StiErrorTemplate.json&#39; }).count()</p><p>db.fs.files.find( { &#39;metadata.ReportTemplateName&#39;: &#39;Sti Error Template&#39; }).count()</p><p><br></p><p>// Update the filename</p><p>db.fs.files.update({&#39;filename&#39;: &#39;StiErrorTemplate.json&#39;}, { $set: {&#39;filename&#39;: &#39;ErrorTemplate.json&#39;} }, { multi: true })</p><p>// Update the metadata</p><p>db.fs.files.update({&#39;metadata.ReportTemplateName&#39;: &#39;Sti Error Template&#39;}, { $set: {&#39;metadata.ReportTemplateName&#39;: &#39;Error Template&#39;} }, { multi: true })</p><p>db.fs.files.update({&#39;metadata.FileName&#39;: &#39;StiErrorTemplate.json&#39;}, { $set: {&#39;metadata.FileName&#39;: &#39;ErrorTemplate.json&#39;} }, { multi: true })</p><p><br></p><p>// Find the number of Templates, filename and metadata counts should match</p><p>db.fs.files.find( { &#39;filename&#39;: &#39;ErrorTemplate.json&#39; }).count()</p><p>db.fs.files.find( { &#39;metadata.ReportTemplateName&#39;: &#39;Error Template&#39; }).count()</p>
</body>
</html>