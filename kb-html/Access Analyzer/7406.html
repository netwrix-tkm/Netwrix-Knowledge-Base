<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove Stale Hosts from Access Analyzer Console</title>
    <meta name="product" content="enterprise_auditor">
    <meta name="ArticleCaseAttachCount" content="0">
    <meta name="ArticleCreatedById" content="0054u000006god6AAA">
    <meta name="ArticleCreatedDate" content="2022-02-01T18:45:45.000Z">
    <meta name="Article_Drafts_Folder__c" content="https://nwxcorp.sharepoint.com/sites/TechnicalSupportOperations/Shared%20Documents/Technical%20Knowledge%20Management/Salesforce%20Knowledge%20Drafts/kA04u0000000IzUCAU">
    <meta name="Article_Reviewer__c" content="nan">
    <meta name="Article_SME__c" content="nan">
    <meta name="Article_Version_Origin__c" content="nan">
    <meta name="Asana_Task_URL__c" content="nan">
    <meta name="AssignedById" content="nan">
    <meta name="AssignedToId" content="nan">
    <meta name="AssignmentDate" content="nan">
    <meta name="AssignmentDueDate" content="nan">
    <meta name="AssignmentNote" content="nan">
    <meta name="Case__c" content="nan">
    <meta name="Confidence_Level__c" content="nan">
    <meta name="CreatedById" content="0054u000006god6AAA">
    <meta name="CreatedDate" content="2025-05-05T10:53:14.000Z">
    <meta name="Draft_Status__c" content="nan">
    <meta name="FirstPublishedDate" content="2022-02-01T18:45:46.000Z">
    <meta name="IsLatestVersion" content="True">
    <meta name="KnowledgeArticleId" content="kA04u0000000IzUCAU">
    <meta name="Knowledge_Article_ID__c" content="kA04u0000000IzUCAU">
    <meta name="LastModifiedById" content="0054u0000093LZ4AAM">
    <meta name="LastModifiedDate" content="2025-05-05T10:58:43.000Z">
    <meta name="LastPublishedDate" content="2022-02-22T13:40:14.000Z">
    <meta name="Meta_Description__c" content="360008408371">
    <meta name="Meta_Title__c" content="Remove Stale Hosts from Access Analyzer Console">
    <meta name="OwnerId" content="0054u000006god6AAA">
    <meta name="PublishStatus" content="Online">
    <meta name="RecordTypeId" content="0124u000000UUgLAAW">
    <meta name="UrlName" content="7406">
    <meta name="VersionNumber" content="2">
    <meta name="Website_URL__c" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA04u0000000IzUCAU.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>Remove Stale Hosts from Access Analyzer Console</h1>
    <p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> Stale hosts clutter reporting and show &quot;Licensed host count exceeded&quot; banner.</p>

<p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> Describes how to automatically remove (purge) stale hosts from target host lists and the Netwrix Access Analyzer console based on staleness. The stale hosts are defined by their existence in the #tmp temp table.<br><br>Two versions are shown below. The first is more complex because it supports multiple consoles and will only purge hosts from the Access Analyzer console specified in the <span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">@SA_Host</span></span></span> variable. The second will purge from all consoles.<br> <br>Standard criteria that define a stale host in these scripts are either that the AD Object has a LastLogonTimestamp older than 90 days, or that the LastOnline value for the host in Host Management is older than 90 days.<br> <br><strong>NOTE:</strong> This is designed to work for short names, and will not work for FQDNs without further modifications.<br> <br> <br><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--define Access Analyzer host so we don&#39;t delete from other consoles</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">declare</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> @SA_Host </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">varchar</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">64</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">set</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> @SA_Host</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">=</span></span></span><span style="color: red;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">&#39;YourSAHostName&#39;</span></span></span><br> <br><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--find stale computer objects based on AD or LastOnline in Host Inventory</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">name</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">,</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostid </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">into</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SA_HostMasterTbl</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">Name</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">in</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span> <span style="color: fuchsia;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">substring</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">SamAccountName</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">,</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">1</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">,</span></span></span><span style="color: fuchsia;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">len</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">samaccountname</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)-</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">1</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SA_ADInventory_ComputersView </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> LastLogonTimestamp</span></span></span><span style="color: gray;"><span style="color: fuchsia;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">getdate</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">()-</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">90</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">))</span></span></span><br><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">or</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> LastOnline </span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: fuchsia;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">getdate</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">()-</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">90</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span><br> <br><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--make hosts no longer visible in the console</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">delete</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostMaster_SANodeFilter </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostID </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">in</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostID </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">and</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SA_Node</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">@SA_Host</span></span></span><br> <br><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--delete from all host lists in the console</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">delete</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HLC</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostListsContentTbl HLC</span></span></span><br><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">inner</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">join</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostListsTbl HLT</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">on</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HLT</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">listID</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">HLC</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">listID </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">and</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> <a href="mailto:HLT.SA_Node=@SA_Host" target="_blank">HLT.SA_Node=@SA_Host</a></span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HLC</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">hostid </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">in</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostID </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span><br> <br><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--delete host from host master table if it&#39;s not referenced anywhere else</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">delete</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SA_HostMasterTbl </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostID </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">in</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><br>       <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostid </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SA_HostMasterTbl HMT</span></span></span><br>       <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostid </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">in</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostid </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span> <span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--it&#39;s been identified as stale</span></span></span><br>       <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">and</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">not</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">exists</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">null</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostMaster_SANodeFilter SANF </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SANF</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">hostID</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">HMT</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">hostID </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">and</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SANF</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">SA_Node</span></span></span><span style="color: gray;"><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">@SA_Host</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span> <span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--it&#39;s not visible in any other consoles</span></span></span><br>       <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">and</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">not</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">exists</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">null</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostListsContentTbl HLC  </span></span></span><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">-- it&#39;s not in any host lists on any other consoles</span></span></span><br>              <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">inner</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">join</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostListsTbl HLT</span></span></span><br>              <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">on</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HLT</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">listID</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">HLC</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">listID </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">AND</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HLT</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">SA_Node</span></span></span><span style="color: gray;"><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">@SA_Host</span></span></span><br>              <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HLC</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">hostID</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">HMT</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">.</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">hostID</span></span></span><br>       <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span><br><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span><br> <br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">drop</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">table</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp</span></span></span><br> <br> </span></span></span></p>

<p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> <span style="color: #1f497d;">Assuming you only have one console, this gets considerably easier..</span><br> <br><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--find stale computer objects based on AD or LastOnline in Host Inventory</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">name</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">,</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostid </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">into</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SA_HostMasterTbl</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">Name</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">in</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span> <span style="color: fuchsia;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">substring</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">SamAccountName</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">,</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">1</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">,</span></span></span><span style="color: fuchsia;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">len</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">samaccountname</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)-</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">1</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SA_ADInventory_ComputersView </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> LastLogonTimestamp</span></span></span><span style="color: gray;"><span style="color: fuchsia;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">getdate</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">()-</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">90</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">))</span></span></span><br><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">or</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> LastOnline </span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: fuchsia;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">getdate</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">()-</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">90</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span><br> <br><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--make hosts no longer visible in the console</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">delete</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostMaster_SANodeFilter </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostID </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">in</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostID </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">and</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SA_Node</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">=</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">@SA_Host</span></span></span><br> <br><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--delete from all host lists in the console</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">delete</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostListsContentTbl</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostid </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">in</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostID </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span><br> <br><span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--delete host from host master table if it&#39;s not referenced anywhere else</span></span></span><br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">delete</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> SA_HostMasterTbl </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">where</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> HostID </span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">in</span></span></span> <span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">(</span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">select</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> hostid </span></span></span><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">from</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp</span></span></span><span style="color: gray;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">)</span></span></span> <span style="color: green;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">--it&#39;s been identified as stale</span></span></span><br> <br><span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">drop</span></span></span> <span style="color: blue;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;">table</span></span></span><span style="color: black;"><span style="font-family: consolas;"><span style="font-size: 9.5pt;"> #tmp</span></span></span><br> <br><span style="color: #1f497d;">Just edit the criteria as you wish in the population of #tmp.</span><br> </span></p>

<p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> Access Analyzer<br><strong><span class="wysiwyg-font-size-large">Module:</span></strong> Access Analyzer - Core<br><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> 6.3+<br><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 2291</p>
</body>
</html>