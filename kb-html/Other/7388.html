<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to Separate SFAM Activity Files into Separate Files for Different Servers</title>
    <meta name="visibility" content="employees_v">
    <meta name="ArticleCaseAttachCount" content="0">
    <meta name="ArticleCreatedById" content="0054u000006god6AAA">
    <meta name="ArticleCreatedDate" content="2022-02-01T18:45:15.000Z">
    <meta name="Article_Drafts_Folder__c" content="nan">
    <meta name="Article_Reviewer__c" content="nan">
    <meta name="Article_SME__c" content="nan">
    <meta name="Article_Version_Origin__c" content="nan">
    <meta name="Asana_Task_URL__c" content="nan">
    <meta name="AssignedById" content="nan">
    <meta name="AssignedToId" content="nan">
    <meta name="AssignmentDate" content="nan">
    <meta name="AssignmentDueDate" content="nan">
    <meta name="AssignmentNote" content="nan">
    <meta name="Case__c" content="nan">
    <meta name="Confidence_Level__c" content="nan">
    <meta name="CreatedById" content="0054u000006god6AAA">
    <meta name="CreatedDate" content="2023-05-08T10:07:00.000Z">
    <meta name="Draft_Status__c" content="nan">
    <meta name="FirstPublishedDate" content="2022-02-01T18:45:15.000Z">
    <meta name="IsLatestVersion" content="True">
    <meta name="KnowledgeArticleId" content="kA04u0000000IRRCA2">
    <meta name="Knowledge_Article_ID__c" content="kA04u0000000IRRCA2">
    <meta name="LastModifiedById" content="0054u000006gSmgAAE">
    <meta name="LastModifiedDate" content="2023-05-08T10:07:00.000Z">
    <meta name="LastPublishedDate" content="2022-02-01T18:45:15.000Z">
    <meta name="Meta_Description__c" content="360008602431">
    <meta name="Meta_Title__c" content="How to Separate SFAM Activity Files into Separate Files for Different Servers">
    <meta name="OwnerId" content="0054u000006god6AAA">
    <meta name="PublishStatus" content="Online">
    <meta name="RecordTypeId" content="0124u000000UUgLAAW">
    <meta name="UrlName" content="7388">
    <meta name="VersionNumber" content="1">
    <meta name="Website_URL__c" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA04u0000000IRRCA2.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>How to Separate SFAM Activity Files into Separate Files for Different Servers</h1>
    <p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> PowerShell script created to break SFAM TSV Files into multiple server based on column name for host</p><p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> <span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;"> In certain situations (misconfigurations or the defect mentioned here), it&#39;s possible for the activity from multiple hosts to be written to the same SAM log file. While there is a column in the file to represent the host name, the FSAC scan relies entirely on the name of the file and ignores this column. As a result, if FSAC is run against these files, activity may be reported as having occurred on the wrong server.</span></span><br><br><span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;">Updating to the latest version of SFAM\SFAM agent will resolve this issue moving forward but it won&#39;t fix the existing files. If we&#39;ve already run FSAC against these files, this will not remove the activity from the database.  There may be instances where the customer stopped the scan after observing the error or would like to pull the information into the right server.  This script has been created to split the log file into separate logs that are named and filtered according to the value found in the Host column within the file.</span></span><br> </p><p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> <span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;">Copy Activity TSV files to temp location</span></span><br><br><span style="font-size: 11pt;"><span style="font-family: Calibri,sans-serif;">Update the PowerShell scripts with these variables based on your customer&#39;s environment</span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$logfilepath</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgreen;">#folder path where log file is located</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$logfilename</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgreen;">#actual log file name to process</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$outputfolder</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgreen;">#location where split log files are</span></span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkgreen;">#Run PowerShell Script Below </span></span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkgreen;">#Dissects log file and makes smaller log files</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkgreen;">#Script takes value from column in target log file</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkgreen;">#makes new file with name of the value in the selected column</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkgreen;">#puts all lines that match that value in chosen </span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkgreen;">#column in perspective new log file</span></span></span></span></span></span></span><br><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkgreen;">#configuration</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$logfilepath</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;C:\desktop\Split file on separator&quot;</span> <span style="color: darkgreen;">#folder path where log file is located</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$logfilename</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;SBSLAB-AUDIT_Log_20190527.tsv&quot;</span> <span style="color: darkgreen;">#actual log file name to process</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$logfileextension</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: orangered;">$logfilename</span><span style="color: darkgray;">.</span>substring(<span style="color: orangered;">$logfilename</span><span style="color: darkgray;">.</span>IndexOf(<span style="color: darkred;">&quot;_&quot;</span>)<span style="color: darkgray;">,</span> <span style="color: orangered;">$logfilename</span><span style="color: darkgray;">.</span>length <span style="color: darkgray;">-</span> <span style="color: orangered;">$logfilename</span><span style="color: darkgray;">.</span>IndexOf(<span style="color: darkred;">&quot;_&quot;</span>)) <span style="color: darkgreen;">#separates the date part of the file name</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$outputfolder</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;C:\desktop\Split file on separator\output&quot;</span> <span style="color: darkgreen;">#location where split log files are</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$delimiter</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;`t&quot;</span> <span style="color: darkgreen;">#delimiter between fields in log file</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$fieldnumber</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;1&quot;</span> <span style="color: darkgreen;">#first field is 0; field obviously needs valid file system character. Change this to 5 for folder name used to separate files by subfolders</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$hasheader</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: orangered;">$false</span> <span style="color: darkgreen;">#value is true or false if the file contains a header row</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$statusupdate</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: purple;">100000</span> <span style="color: darkgreen;">#update every x number of lines processed</span></span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkgreen;">#reset values for script execution</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$filename</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;&quot;</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$outdata</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;&quot;</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$line</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;&quot;</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$linecounter</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: purple;">0</span></span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$logfile</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;</span><span style="color: orangered;">$logfilepath</span><span style="color: darkred;">\</span><span style="color: orangered;">$logfilename</span><span style="color: darkred;">&quot;</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$starttime</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: blue;">get-date</span></span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: orangered;">$logfilecontents</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkgray;">=</span> <span style="color: blue;">New-Object</span> <span style="color: navy;">-TypeName</span> <span style="color: blueviolet;">System.IO.StreamReader</span> <span style="color: navy;">-ArgumentList</span> <span style="color: orangered;">$logfile</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"> </span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkblue;">while</span></span></span><span style="font-size: 9pt;"><span> (<span style="color: orangered;">$line</span> <span style="color: darkgray;">=</span> <span style="color: orangered;">$logfilecontents</span><span style="color: darkgray;">.</span>ReadLine()){    </span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    <span style="color: orangered;">$temp</span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;</span>$((<span style="color: orangered;">$line</span> <span style="color: darkgray;">-split</span> <span style="color: orangered;">$delimiter</span>)<span style="color: darkgray;">[</span>(<span style="color: orangered;">$fieldnumber</span>)<span style="color: darkgray;">]</span>)<span style="color: darkred;">&quot;</span> </span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: darkgreen;"># this can be used to separate files by subfolder instead (which was used before Isilon Access Zones were supported in SAM): $temp = &quot;$(($temp -split &quot;\\&quot;)[2])&quot;</span></span></span></span></span></span></span><br><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    <span style="color: orangered;">$filename</span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;</span><span style="color: orangered;">$temp</span><span style="color: darkred;">&quot;</span> <span style="color: darkgray;">+</span> <span style="color: darkred;">&quot;</span><span style="color: orangered;">$logfileextension</span><span style="color: darkred;">&quot;</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    <span style="color: orangered;">$filepath</span> <span style="color: darkgray;">=</span> <span style="color: darkred;">&quot;</span><span style="color: orangered;">$outputfolder</span><span style="color: darkred;">\</span><span style="color: orangered;">$filename</span><span style="color: darkred;">&quot;</span></span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    <span style="color: darkblue;">if</span> (<span style="color: orangered;">$linecounter</span> <span style="color: darkgray;">-eq</span> <span style="color: purple;">0</span> <span style="color: darkgray;">-and</span> <span style="color: orangered;">$hasheader</span>){</span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>        <span style="color: orangered;">$header</span> <span style="color: darkgray;">=</span> <span style="color: orangered;">$line</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    }</span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    <span style="color: darkblue;">else</span>{</span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>        <span style="color: darkblue;">if</span> (<span style="color: darkgray;">-not</span> <span style="color: orangered;">$filearray</span> <span style="color: darkgray;">-contains</span> <span style="color: orangered;">$filepath</span>){</span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>            <span style="color: orangered;">$filearray</span> <span style="color: darkgray;">+=</span> <span style="color: orangered;">$filepath</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>            <span style="color: darkblue;">if</span> (<span style="color: orangered;">$hasheader</span>){</span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>                <span style="color: blue;">add-content</span> <span style="color: orangered;">$filepath</span> <span style="color: orangered;">$header</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>            }</span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>        }</span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>        <span style="color: blue;">Add-Content</span> <span style="color: orangered;">$filepath</span> <span style="color: orangered;">$line</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    }</span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;">   </span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    <span style="color: orangered;">$linecounter</span><span style="color: darkgray;">++</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    <span style="color: darkblue;">if</span> (<span style="color: orangered;">$linecounter</span> <span style="color: darkgray;">%</span> <span style="color: orangered;">$statusupdate</span> <span style="color: darkgray;">-eq</span> <span style="color: purple;">0</span>){</span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>        <span style="color: orangered;">$CurrentTime</span> <span style="color: darkgray;">=</span> <span style="color: blue;">get-date</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>        <span style="color: orangered;">$runduration</span> <span style="color: darkgray;">=</span> (<span style="color: orangered;">$currenttime</span> <span style="color: darkgray;">-</span> <span style="color: orangered;">$starttime</span>)<span style="color: darkgray;">.</span>seconds</span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>        <span style="color: blue;">write-host</span> <span style="color: darkred;">&quot;Lines Processed: </span><span style="color: orangered;">$linecounter</span><span style="color: darkred;">, RunTime: </span><span style="color: orangered;">$RunDuration</span><span style="color: darkred;"> Seconds&quot;</span></span></span></span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;">       </span></span></span></span><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>    } </span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span>}</span></span></span></span></span></span><br><br><span style="font-size: 11pt;"><span><span><span style="font-family: Calibri,sans-serif;"><span style="font-size: 9pt;"><span><span style="color: blue;">write-host</span></span></span><span style="font-size: 9pt;"><span> <span style="color: darkred;">&quot;Lines Processed: </span><span style="color: orangered;">$linecounter</span><span style="color: darkred;">, RunTime: </span><span style="color: orangered;">$RunDuration</span><span style="color: darkred;"> Seconds&quot;</span></span></span></span></span></span></span><br><br><br><br><span style="font-size: 11pt;"><span>Note: Because this script contains write-host, we cannot put it directly into the PowerShell DC without further modification. Additional changes and testing may be required for that use case.</span></span></p><p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> STEALTHbits File Activity Monitor<br><strong><span class="wysiwyg-font-size-large">Module:</span></strong> File Activity Monitor - EMC/Celerra;File Activity Monitor - NetApp;File Activity Monitor - Windows<br><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> 2.2, 2.3, 2.4, 2.5<br><strong><span class="wysiwyg-font-size-large">Dev Ticket:</span></strong> SFAM-3333<br><strong><span class="wysiwyg-font-size-large">Resolved In:</span></strong> 2.5<br><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 2397<br></p>
</body>
</html>