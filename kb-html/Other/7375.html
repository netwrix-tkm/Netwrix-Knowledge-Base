<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Run Time Estimation</title>
    <meta name="visibility" content="employees_v">
    <meta name="ArticleCaseAttachCount" content="0">
    <meta name="ArticleCreatedById" content="0054u000006god6AAA">
    <meta name="ArticleCreatedDate" content="2022-02-01T18:44:42.000Z">
    <meta name="Article_Drafts_Folder__c" content="nan">
    <meta name="Article_Reviewer__c" content="nan">
    <meta name="Article_SME__c" content="nan">
    <meta name="Article_Version_Origin__c" content="nan">
    <meta name="Asana_Task_URL__c" content="nan">
    <meta name="AssignedById" content="nan">
    <meta name="AssignedToId" content="nan">
    <meta name="AssignmentDate" content="nan">
    <meta name="AssignmentDueDate" content="nan">
    <meta name="AssignmentNote" content="nan">
    <meta name="Case__c" content="nan">
    <meta name="Confidence_Level__c" content="nan">
    <meta name="CreatedById" content="0054u000006god6AAA">
    <meta name="CreatedDate" content="2023-05-08T10:12:56.000Z">
    <meta name="Draft_Status__c" content="nan">
    <meta name="FirstPublishedDate" content="2022-02-01T18:44:43.000Z">
    <meta name="IsLatestVersion" content="True">
    <meta name="KnowledgeArticleId" content="kA04u0000000IxxCAE">
    <meta name="Knowledge_Article_ID__c" content="kA04u0000000IxxCAE">
    <meta name="LastModifiedById" content="0054u000006gSmgAAE">
    <meta name="LastModifiedDate" content="2023-05-08T10:12:56.000Z">
    <meta name="LastPublishedDate" content="2022-02-01T18:44:43.000Z">
    <meta name="Meta_Description__c" content="360008408371">
    <meta name="Meta_Title__c" content="Run Time Estimation">
    <meta name="OwnerId" content="0054u000006god6AAA">
    <meta name="PublishStatus" content="Online">
    <meta name="RecordTypeId" content="0124u000000UUgLAAW">
    <meta name="UrlName" content="7375">
    <meta name="VersionNumber" content="1">
    <meta name="Website_URL__c" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA04u0000000IxxCAE.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>Run Time Estimation</h1>
    <p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> Given a JobName, this will estimate the time that a particular job will finish, based on the assumption that each host will take approximately the same amount of time to process.</p><p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> I recently ran into a situation where the Bulk Import job was taking much longer than normal to complete, and had to come up with an estimate for when it will actually complete, given current progress. Step in the JobTaskStats table.<br> <br>Given a JobName, this will estimate the time that a particular job will finish, based on the assumption that each host will take approximately the same amount of time to process.<br> </p><p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong>  <br><span style="color: green;"><span style="font-family: courier new;"><span style="font-size: 10pt;">/*-------------------------------------------------------------------</span></span></span><br><span style="color: green;"><span style="font-family: courier new;"><span style="font-size: 10pt;">Copyright (C) 2017 STEALTHbits Technologies, Inc.</span></span></span><br><span style="color: green;"><span style="font-family: courier new;"><span style="font-size: 10pt;">Written by:          Kyle Enman</span></span></span><br><span style="color: green;"><span style="font-family: courier new;"><span style="font-size: 10pt;">Date:                7/5/2017</span></span></span><br><span style="color: green;"><span style="font-family: courier new;"><span style="font-size: 10pt;">Purpose:             Estimates Job Completion</span></span></span><br> <br><span style="color: green;"><span style="font-family: courier new;"><span style="font-size: 10pt;">Revision History: When/Who/What (most recent at top)</span></span></span><br><span style="color: green;"><span style="font-family: courier new;"><span style="font-size: 10pt;">      2017/07/24 / Kyle Enman / Simplified by using variables and updated to exclude pre-processing (time between JRTK and MIN(StartTime) of first job task) time in estimate.</span></span></span><br><span style="color: green;"><span style="font-family: courier new;"><span style="font-size: 10pt;">---------------------------------------------------------------------*/</span></span></span><br> <br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">IF</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> <span style="color: fuchsia;">OBJECT_ID</span><span style="color: gray;">(</span><span style="color: red;">&#39;SA_JobEstimator_Result&#39;</span><span style="color: gray;">,</span> <span style="color: red;">&#39;u&#39;</span><span style="color: gray;">)</span> <span style="color: gray;">IS</span> <span style="color: gray;">NOT</span> <span style="color: gray;">NULL</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">DROP</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> <span style="color: blue;">TABLE</span> SA_JobEstimator_Result</span></span><br> <br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">declare</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @JobName <span style="color: blue;">varchar</span><span style="color: gray;">(</span>64<span style="color: gray;">)</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">declare</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @JobRunTimeKey <span style="color: blue;">smalldatetime</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">declare</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @JobProcessStart <span style="color: blue;">smalldatetime</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">declare</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @HostsTargeted <span style="color: blue;">int</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">declare</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @HostsProcessed <span style="color: blue;">int</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">set</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @JobName<span style="color: gray;">=</span><span style="color: red;">&#39;2-FSAA Bulk Import&#39;</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">set</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @JobRunTimeKey<span style="color: gray;">=(</span><span style="color: blue;">select</span> <span style="color: fuchsia;">MAX</span><span style="color: gray;">(</span>JobRunTimeKey<span style="color: gray;">)</span> <span style="color: blue;">from</span> SA_JobStatsTbl <span style="color: blue;">WHERE</span> JobName<span style="color: gray;">=</span>@JobName<span style="color: gray;">)</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">set</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @JobProcessStart<span style="color: gray;">=(</span><span style="color: blue;">select</span> <span style="color: fuchsia;">MIN</span><span style="color: gray;">(</span>StartTime<span style="color: gray;">)</span> <span style="color: blue;">from</span> SA_JobTaskStatsTbl <span style="color: blue;">WHERE</span> JobName<span style="color: gray;">=</span>@JobName <span style="color: gray;">and</span> JobRunTimeKey<span style="color: gray;">=</span>@JobRunTimeKey<span style="color: gray;">)</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">set</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @HostsTargeted<span style="color: gray;">=(</span><span style="color: blue;">select</span> <span style="color: fuchsia;">COUNT</span><span style="color: gray;">(*)</span> <span style="color: blue;">from</span> SA_JobTaskStatsTbl <span style="color: blue;">WHERE</span> JobName<span style="color: gray;">=</span>@JobName <span style="color: gray;">AND</span> JobRunTimeKey<span style="color: gray;">=</span>@JobRunTimeKey <span style="color: gray;">AND</span> TaskType<span style="color: gray;">=</span><span style="color: red;">&#39;Query&#39;</span><span style="color: gray;">)</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">set</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> @HostsProcessed<span style="color: gray;">=(</span><span style="color: blue;">select</span> <span style="color: fuchsia;">COUNT</span><span style="color: gray;">(*)</span> <span style="color: blue;">from</span> SA_JobTaskStatsTbl <span style="color: blue;">WHERE </span><span style="color: gray;">(</span>JobName<span style="color: gray;">=</span>@JobName<span style="color: gray;">)</span> <span style="color: gray;">AND</span> JobRunTimeKey<span style="color: gray;">=</span>@JobRunTimeKey <span style="color: gray;">AND</span> <span style="color: blue;">Status</span> <span style="color: gray;">not</span> <span style="color: gray;">in</span> <span style="color: gray;">(</span><span style="color: red;">&#39;Queued&#39;</span><span style="color: gray;">,</span> <span style="color: red;">&#39;Running&#39;</span><span style="color: gray;">))</span></span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">select</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> <span style="color: fuchsia;">CAST</span><span style="color: gray;">(</span><span style="color: fuchsia;">getdate</span><span style="color: gray;">()</span> <span style="color: blue;">as</span> <span style="color: blue;">datetime</span><span style="color: gray;">)</span> <span style="color: blue;">as</span> CurrentTime</span></span><br><span style="color: gray;"><span style="font-family: courier new;"><span style="font-size: 10pt;">,</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;">     @JobName <span style="color: blue;">as</span> JobName</span></span><br><span style="color: gray;"><span style="font-family: courier new;"><span style="font-size: 10pt;">,</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;">     @JobRunTimeKey <span style="color: blue;">as</span> JobStart</span></span><br><span style="color: gray;"><span style="font-family: courier new;"><span style="font-size: 10pt;">,</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;">     @JobProcessStart <span style="color: blue;">as</span> JobProcessingStarted</span></span><br><span style="color: gray;"><span style="font-family: courier new;"><span style="font-size: 10pt;">,</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;">     @HostsTargeted <span style="color: blue;">as</span> HostsTargeted</span></span><br><span style="color: gray;"><span style="font-family: courier new;"><span style="font-size: 10pt;">,</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;">     @HostsProcessed <span style="color: blue;">as</span> HostsProcessed</span></span><br><span style="color: gray;"><span style="font-family: courier new;"><span style="font-size: 10pt;">,</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;">     <span style="color: fuchsia;">dateadd</span><span style="color: gray;">(</span><span style="color: blue;">second</span><span style="color: gray;">,((</span>1.0<span style="color: gray;">*</span><span style="color: fuchsia;">DATEDIFF</span><span style="color: gray;">(</span><span style="color: blue;">second</span><span style="color: gray;">,</span>@JobProcessStart<span style="color: gray;">,</span><span style="color: fuchsia;">ISNULL</span><span style="color: gray;">((</span><span style="color: blue;">SELECT</span> EndTime <span style="color: blue;">FROM</span> SA_JobStatsTbl <span style="color: blue;">WHERE</span> JobName<span style="color: gray;">=</span>@JobName <span style="color: gray;">AND</span> JobRunTimeKey<span style="color: gray;">=</span>@JobRunTimeKey<span style="color: gray;">),</span><span style="color: fuchsia;">getdate</span><span style="color: gray;">())))/</span></span></span><br><span style="color: gray;"><span style="font-family: courier new;"><span style="font-size: 10pt;">(</span></span></span><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">select</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> <a href="mailto:1.0*@HostsProcessed/(1.0*@HostsTargeted))),@JobProcessStart)" target="_blank">1.0*@HostsProcessed/(1.0*@HostsTargeted))),@JobProcessStart)</a> <span style="color: blue;">AS</span> ExpectedFinish</span></span><br><span style="color: blue;"><span style="font-family: courier new;"><span style="font-size: 10pt;">INTO</span></span></span><span style="font-family: courier new;"><span style="font-size: 10pt;"> SA_JobEstimator_Result</span></span><br> </p><p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthAUDIT<br><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - Core<br><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 1648<br></p>
</body>
</html>