<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Network Port</title>
    <meta name="visibility" content="employees_v">
    <meta name="ArticleCaseAttachCount" content="0">
    <meta name="ArticleCreatedById" content="0054u000006god6AAA">
    <meta name="ArticleCreatedDate" content="2022-02-01T18:44:44.000Z">
    <meta name="Article_Drafts_Folder__c" content="nan">
    <meta name="Article_Reviewer__c" content="nan">
    <meta name="Article_SME__c" content="nan">
    <meta name="Article_Version_Origin__c" content="nan">
    <meta name="Asana_Task_URL__c" content="nan">
    <meta name="AssignedById" content="nan">
    <meta name="AssignedToId" content="nan">
    <meta name="AssignmentDate" content="nan">
    <meta name="AssignmentDueDate" content="nan">
    <meta name="AssignmentNote" content="nan">
    <meta name="Case__c" content="nan">
    <meta name="Confidence_Level__c" content="nan">
    <meta name="CreatedById" content="0054u000006god6AAA">
    <meta name="CreatedDate" content="2023-05-08T10:12:57.000Z">
    <meta name="Draft_Status__c" content="nan">
    <meta name="FirstPublishedDate" content="2022-02-01T18:44:44.000Z">
    <meta name="IsLatestVersion" content="True">
    <meta name="KnowledgeArticleId" content="kA04u0000000Iy7CAE">
    <meta name="Knowledge_Article_ID__c" content="kA04u0000000Iy7CAE">
    <meta name="LastModifiedById" content="0054u000006gSmgAAE">
    <meta name="LastModifiedDate" content="2023-05-08T10:12:57.000Z">
    <meta name="LastPublishedDate" content="2022-02-01T18:44:44.000Z">
    <meta name="Meta_Description__c" content="360008816812">
    <meta name="Meta_Title__c" content="Test Network Port">
    <meta name="OwnerId" content="0054u000006god6AAA">
    <meta name="PublishStatus" content="Online">
    <meta name="RecordTypeId" content="0124u000000UUgLAAW">
    <meta name="UrlName" content="7377">
    <meta name="VersionNumber" content="1">
    <meta name="Website_URL__c" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA04u0000000Iy7CAE.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>Test Network Port</h1>
    <p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> Troubleshooting firewall issues with PowerShell</p>
<p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> <span style="color: black;">Before deploying Stealthbits</span><span style="color: #1f497d;">&#39;</span><span style="color: black;"> products</span><span style="color: #1f497d;">,</span><span style="color: black;"> there are a number of firewall ports required to open.  Using Windows PowerShell to create a Function</span><span style="color: #1f497d;">,</span><span style="color: black;"> we can initiate a port listener and verify that there is proper connectivity between servers and clients (e.g., Proxy and StealthAUDIT), or if firewalls are blocking those ports. </span><br><strong><em><span style="color: #4472c4;">Before running any PowerShell scripts we need to make sure they are not blocked by the Execution Policy.</span></em></strong><br><br><strong><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 16pt;">On the server (the computer where the port needs to be open)</span></span></span></strong><br><br><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">1) Paste the below script into a PowerShell or PowerShell ISE session running as administrator on the server.</span></span></span></p>
<ol style="list-style-type: lower-alpha;"><li><strong><em><span style="color: #4472c4;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">ALTERNATIVELY, copy below PowerShell script into a text file and Save it with extension .ps1, zip it and send it to customer</span></span></span></em></strong></li><li><strong><em><span style="color: #4472c4;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">Open PowerShell on Windows server you want the port to listen on</span></span></span></em></strong></li><li>
<strong><em><span style="color: #4472c4;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">Make sure the Execution Policy will not block the script by use of cmdlet &quot;powershell -ExecutionPolicy Bypass&quot;</span></span></span></em></strong> <strong><em><span style="color: #4472c4;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">(this will only be effective in this PowerShell session)</span></span></span></em></strong>
</li></ol>
<p><strong><em><span style="color: red;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">OR</span></span></span></em></strong></p>
<ol style="list-style-type: lower-alpha;"><li><strong><em><span style="color: red;">Use cmdlet &quot;Get-ExecutionPolicy&quot; to get the original setting.  Then use cmdlet  &quot;Set-ExecutionPolicy Unrestricted -Force&quot; and make sure to set it back to original setting after helping customer. </span></em></strong></li><li><strong><em><span style="color: #4472c4;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">Run the PowerShell script created</span></span></span></em></strong></li></ol>
<p> <br><strong><em><span style="color: #4472c4;">-Note: Changing the Execution Policy allows you to send the PowerShell script to the customer as a ps1 file via zip file, easy for the customer to download and for you to execute it </span></em></strong><strong><em><span style="color: #4472c4;">by calling it from PowerShell allowing an easier transition. Instead of you sending them the whole script string on email or GTM chat and then pasting it, where it </span></em></strong><strong><em><span style="color: #4472c4;">may raise concern to see a bunch of code.</span></em></strong><br> <br> <br> <br> <br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"></span></span><br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Copyright (C) 2018 STEALTHBITS TECHNOLOGIES, INC.</span></span></span><br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Written by:  Ricky Calder</span></span></span><br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Date:        2018/05/25</span></span></span><br> <br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.DESCRIPTION</span></span></span><br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Assist in troubleshooting firewall issues. Creates a listener on selected port.</span></span></span><br> <br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.PARAMETER Port</span></span></span><br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">The TCP port that the listener should attach to</span></span></span><br> <br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">#&gt;</span></span></span><br><span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">function</span></span></span> <span style="color: blueviolet;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">STEALTHTest-Port</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">{</span></span></span><br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"># Define Parameter</span></span></span><br><span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Param</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"> (</span></span></span><br>  <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">[</span></span></span><span style="color: deepskyblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Parameter</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">(Mandatory</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$True</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">,</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Position</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span><span style="color: purple;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">0</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">,</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">HelpMessage</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span><span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;Specify Port to listen on&quot;</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">)</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">]</span></span></span><br>  <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">[</span></span></span><span style="color: teal;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">string</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">]</span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$Port</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">,</span></span></span><br> <br>  <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">[</span></span></span><span style="color: deepskyblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Parameter</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">(Mandatory</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$True</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">,</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Position</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span><span style="color: purple;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">2</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">,</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">HelpMessage</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span><span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;Log file location&quot;</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">)</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">]</span></span></span><br>   <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">[</span></span></span><span style="color: deepskyblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">ValidateScript</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">({</span></span></span><br>        <span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">If</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">(</span></span></span><span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Test-Path</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$_</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">){</span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$true</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">}</span></span></span><span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">else</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">{</span></span></span><span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Throw</span></span></span> <span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;Invalid path given: </span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$_</span></span></span><span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">}</span></span></span><br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">        })</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">]</span></span></span><br>  <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">[</span></span></span><span style="color: teal;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">string</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">]</span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$LogFilePath</span></span></span><br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">)</span></span></span><br> <br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"># Create Log function</span></span></span><br> <br><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$Logfile</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$LogFilePath</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+</span></span></span><span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&#39;\&#39;</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"> $(</span></span></span><span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Get-Date</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">)</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">tostring(</span></span></span><span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;ddMMyyyyHHmm&quot;</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">)</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+</span></span></span><span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&#39;.log&#39;</span></span></span><br> <br><span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Function</span></span></span> <span style="color: blueviolet;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">LogWrite</span></span></span><br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">{</span></span></span><br>   <span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Param</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"> (</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">[</span></span></span><span style="color: teal;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">string</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">]</span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$logstring</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">)</span></span></span><br>   <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$logstring</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$(</span></span></span><span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">get-date</span></span></span> <span style="color: navy;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">-Format</span></span></span> <span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;yyyy-MM-dd HH:mm:ss&quot;</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">)</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+</span></span></span><span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;`t&quot;</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+</span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$LogString</span></span></span><br>   <span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Add-content</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$Logfile</span></span></span> <span style="color: navy;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">-value</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$LogString</span></span></span> <br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">}</span></span></span><br> <br><span style="color: darkgreen;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"># Port Listener </span></span></span><br> <br>    <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$endpoint</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span> <span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">new-object</span></span></span> <span style="color: blueviolet;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">System.Net.IPEndPoint</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"> (</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">[</span></span></span><span style="color: teal;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">system.net.ipaddress</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">]::</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">any</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">,</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$port</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">)    </span></span></span><br>    <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$listener</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span> <span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">new-object</span></span></span> <span style="color: blueviolet;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">System.Net.Sockets.TcpListener</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$endpoint</span></span></span><br>    <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$listener</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">server</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">ReceiveTimeout </span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span> <span style="color: purple;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">5000</span></span></span><br>    <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$listener</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">start()    </span></span></span><br>    <span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">try</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"> {</span></span></span><br>    <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$Logstring</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span> <span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;Listening on port </span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$port</span></span></span><span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;</span></span></span><br>    <span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Logwrite</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$Logstring</span></span></span><br>    <span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">While</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"> (</span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$true</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">){</span></span></span><br>        <span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">if</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"> (</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">!</span></span></span><span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$listener</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Pending())</span></span></span><br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">        {</span></span></span><br>            <span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Start-Sleep</span></span></span> <span style="color: navy;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">-Seconds</span></span></span> <span style="color: purple;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">1</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">; </span></span></span><br>            <span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">continue</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">; </span></span></span><br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">        }</span></span></span><br>       <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$client</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$listener</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">AcceptTcpClient()</span></span></span><br>       <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$Logstring</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span> <span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;Client IP Address &quot;</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$client</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">client</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">RemoteEndPoint </span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+</span></span></span> <span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot; Successfully Connected&quot;</span></span></span><br>       <span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">logwrite</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$Logstring</span></span></span><br>       <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$client</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">close()</span></span></span><br>    <br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">        }</span></span></span><br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">    }</span></span></span><br>    <span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">catch</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;"> {</span></span></span><br>       <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$logstring</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span> <span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Write-Error</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$_</span></span></span>     <br>       <span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">logwrite</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$Logstring</span></span></span>     <br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">    }</span></span></span><br>    <span style="color: darkblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">finally</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">{</span></span></span><br>            <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$listener</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">.</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">stop()</span></span></span><br>            <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$Logstring</span></span></span> <span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">=</span></span></span> <span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;Listener Closed Safely&quot;</span></span></span><br>            <span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">logwrite</span></span></span> <span style="color: orangered;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">$logstring</span></span></span> <br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">    }</span></span></span><br> <br><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">}</span></span></span></span></p>
<p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> <span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">2) Ensure that no other applications are running on the server by running netstat on the server and searching for the port to be tested.</span></span></span><br><span style="color: white;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">C:\Windows\system32&gt; netstat -a -o</span></span></span><br><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;"> <br>You should NOT see the port in the list if it&#39;s not in use by another program. If you do, look at the PID specified in the results table and correlate to a process in task manager. You may have to stop services or close programs to clear.</span></span></span><br> <br> <br><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">3) Execute the PowerShell to create the functions. After executing the PowerShell, the </span></span><span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">STEALTHTest-Port </span></span></span><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">function will be available. This command has two parameters, </span></span><span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Port</span></span></span><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;"> and </span></span><span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">LogfilePath</span></span></span><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">. </span></span></p>
<ol style="list-style-type: lower-alpha;"><li><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">The Port is the port on the server with which the client will try to communicate.</span></span></span></li><li><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">The log file path must be a string that points to a folder that already exists. A log will be created with details on connection (e.g., client IP address if it connects successfully).</span></span></span></li></ol>
<p> <br><span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">STEALTHTest-Port</span></span></span> <span style="color: navy;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">-Port</span></span></span> <span style="color: purple;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">8766</span></span></span> <span style="color: navy;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">-LogFilePath</span></span></span> <span style="color: blueviolet;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">C:\Temp </span></span></span><br><span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">STEALTHTest-Port</span></span></span> <span style="color: purple;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">8766</span></span></span> <span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;C:\Temp Folder&quot;</span></span></span><br> <br><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">Note: When testing is complete, use &quot;Ctrl + C&quot; to stop the listener.<br> <br> <br> </span></span></span><br><strong><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 16pt;">On the client (the computer where the connection is initiated)</span></span></span></strong><br><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">Run the following command in PowerShell or PowerShell ISE</span></span></span><br><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">If the port is closed or the host is invalid (or some other issue), an error will be thrown in the client.  </span></span></span><br><span style="color: blue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">New-Object</span></span></span> <span style="color: blueviolet;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">System.Net.Sockets.TcpClient</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">(</span></span></span><span style="color: darkred;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">&quot;ComputerNameOrIPAddress&quot;</span></span></span><span style="color: darkgray;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">,</span></span></span> <span style="color: purple;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">8766</span></span></span><span style="color: black;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">) </span></span></span><br><br> <br><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">Port Closed:</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">PS C:\Windows\system32&gt; New-Object System.Net.Sockets.TcpClient(&quot;SBTESTSERVER01&quot;, 8766) | fl *</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">New-Object : Exception calling &quot;.ctor&quot; with &quot;2&quot; argument(s): &quot;No connection could be made because the target machine actively refused it 192.168.15.152:8766&quot;</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">At line:1 char:1</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+ New-Object System.Net.Sockets.TcpClient(&quot;SBTESTSERVER01&quot;, 8766) | fl *</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">    + CategoryInfo          : InvalidOperation: (:) [New-Object], MethodInvocationException</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">    + FullyQualifiedErrorId : ConstructorInvokedThrowException,Microsoft.PowerShell.Commands.NewObjectCommand </span></span></span><br> <br><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;">Invalid Host Name</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">PS C:\Windows\system32&gt; New-Object System.Net.Sockets.TcpClient(&quot;SBTESTSERVER02&quot;, 8766) | fl *</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">New-Object : Exception calling &quot;.ctor&quot; with &quot;2&quot; argument(s): &quot;No such host is known&quot;</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">At line:1 char:1</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+ New-Object System.Net.Sockets.TcpClient(&quot;SBTESTSERVER02&quot;, 8766) | fl *</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">    + CategoryInfo          : InvalidOperation: (:) [New-Object], MethodInvocationException</span></span></span><br><span style="color: red;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">    + FullyQualifiedErrorId : ConstructorInvokedThrowException,Microsoft.PowerShell.Commands.NewObjectCommand</span></span></span><br><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;"> <br><br>The full list of Windows Socket Error Codes is available on MSDN - </span></span></span><span style="color: #1f497d;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;"><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms740668(v=vs.85).aspx" target="_blank"><span style="color: #333435;">https://msdn.microsoft.com/en-us/library/windows/desktop/ms740668(v=vs.85).aspx</span></a></span></span></span><br><span style="color: black;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;"> <br>If the port is opening and the port is listening, connection information should be returned:</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">NoDelay             : False </span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">LingerState         : System.Net.Sockets.LingerOption</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">SendTimeout         : 0</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">ReceiveTimeout      : 0</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">SendBufferSize      : 65536</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">ReceiveBufferSize   : 65536</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">ExclusiveAddressUse : False</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Connected           : True</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Available           : 0</span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">Client              : System.Net.Sockets.Socket</span></span></span><br><span style="color: mediumblue;"><span style="font-family: arial,sans-serif;"><span style="font-size: 9pt;"> <br> </span></span></span><br><span style="color: mediumblue;"><span style="font-family: lucida console;"><span style="font-size: 9pt;">S C:\Windows\system32&gt; New-Object System.Net.Sockets.TcpClient(&quot;SBTESTSERVER01&quot;, 8766)</span></span></span><br> </p>
<p><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 1992</p>
</body>
</html>