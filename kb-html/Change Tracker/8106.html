<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>33 Sample Scripts for Agentless FIM</title>
    <meta name="product" content="change_tracker">
    <meta name="ArticleCaseAttachCount" content="0">
    <meta name="ArticleCreatedById" content="0054u000006god6AAA">
    <meta name="ArticleCreatedDate" content="2022-02-07T00:34:55.000Z">
    <meta name="Article_Drafts_Folder__c" content="nan">
    <meta name="Article_Reviewer__c" content="nan">
    <meta name="Article_SME__c" content="nan">
    <meta name="Article_Version_Origin__c" content="nan">
    <meta name="Asana_Task_URL__c" content="nan">
    <meta name="AssignedById" content="nan">
    <meta name="AssignedToId" content="nan">
    <meta name="AssignmentDate" content="nan">
    <meta name="AssignmentDueDate" content="nan">
    <meta name="AssignmentNote" content="nan">
    <meta name="Case__c" content="nan">
    <meta name="Confidence_Level__c" content="nan">
    <meta name="CreatedById" content="0054u000006god6AAA">
    <meta name="CreatedDate" content="2023-05-08T10:17:00.000Z">
    <meta name="Draft_Status__c" content="nan">
    <meta name="FirstPublishedDate" content="2022-02-07T00:34:55.000Z">
    <meta name="IsLatestVersion" content="True">
    <meta name="KnowledgeArticleId" content="kA04u0000000JTUCA2">
    <meta name="Knowledge_Article_ID__c" content="kA04u0000000JTUCA2">
    <meta name="LastModifiedById" content="0054u000006gSmgAAE">
    <meta name="LastModifiedDate" content="2023-05-08T10:17:00.000Z">
    <meta name="LastPublishedDate" content="2022-04-12T16:18:18.000Z">
    <meta name="Meta_Description__c" content="HELPDESK">
    <meta name="Meta_Title__c" content="33 Sample Scripts for Agentless FIM">
    <meta name="OwnerId" content="0054u000006god6AAA">
    <meta name="PublishStatus" content="Online">
    <meta name="RecordTypeId" content="0124u000000UUgLAAW">
    <meta name="UrlName" content="8106">
    <meta name="VersionNumber" content="5">
    <meta name="Website_URL__c" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA04u0000000JTUCA2.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>33 Sample Scripts for Agentless FIM</h1>
    <p><strong><em>Note: For script debugging and advanced scripting requirements, you may find it easier to use the Script Console packaged with any Proxy Agent installation. You can run the Script Console from C:\Program Files\NNT Change Tracker Suite\AgentProxy\ScriptConsole, program name NNT.Script.Console.exe</em></strong></p><p>The sample scripts provided in this section all include a Main Script and a Logon Script dialogue, however, for Production Agentless trackers, the Logon script only is used within the Credentials key with the Main Script commands being configured with the relevant Configuration Template.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LdKB4&amp;d=%2Fa%2F4u000000LzeM%2FxwJ49xCBsKhyoQhvfoOCAu2J2NMHroU1d_BWwMNBJ7c&amp;asPdf=false"></img></span></p><p></p><h2 id="id-33SampleScriptsforAgentlessFIM-1.NortelSwitchTelnetLogin(MenupresentedattheCLI)"><span>1. Nortel Switch Telnet Login (Menu presented at the CLI)</span></h2><p class="MsoNormal" style=""><span>Leave all settings at default then set Username and Password and adjust other settings where specified below:</span></p><p class="MsoNormal" style=""><span>Term Type: </span><span style="">TTY</span></p><p class="MsoNormal" style=""><span>Number of Columns</span><span style="">: 1024</span></p><p class="MsoNormal" style=""><span>Protocol: </span><span style="">Telnet</span><span> </span></p><p class="MsoNormal" style=""><span>New Line: <span style=""> </span></span><span style="">CRLF</span></p><p class="MsoNormal" style=""><span>Un-check </span><span style="">Send credentials with connect</span><span> (because password is sent after CTRL-Y menu stage)</span></p><p class="MsoNormal" style=""><span><br></span></p><p><em style=""><span>Notes - uses CTRL-Y (\x19) to initiate login. Password is sent explicitly using a Send command. Menu control characters are removed from the return data using the StripCtrl command.</span></em></p><h3 class="MsoNormal" id="id-33SampleScriptsforAgentlessFIM-LoginScript:" style=""><span>Login Script: </span></h3><p class="MsoNormal" style=""><span style="">StripCtrl,ON</span></p><p class="MsoNormal" style=""><span style="">Sleep,2</span></p><p class="MsoNormal" style=""><span style=""># Send CTRL-Y</span></p><p class="MsoNormal" style=""><span style="">Send,\\x19</span></p><p class="MsoNormal" style=""><span style="">Sleep,2</span></p><p class="MsoNormal" style=""><span style="">Send,\r\n</span></p><p class="MsoNormal" style=""><span style="">Sleep,2</span></p><p class="MsoNormal" style=""><span style="">Send,$$PASSWORD$$\r\n</span></p><p class="MsoNormal" style=""><span style="">Sleep,2</span></p><p class="MsoNormal" style=""><span>To pick a menu item from the menu that follows and capture the result into </span><span style="">$$RESULT$$:</span></p><p class="MsoNormal" style=""><span><br></span></p><h3 id="id-33SampleScriptsforAgentlessFIM-MainScript:"><span>Main Script:</span></h3><p class="MsoNormal" style=""><span style="">SendCapture,$$RESULT$$,M\r\n</span></p><p class="MsoNormal" style=""><span> </span></p><p><span style="font-size: 10.0pt;font-family: Calibri , sans-serif;"><br style=""> </span></p><p class="MsoNormal" style=""><span> </span></p><h2 id="id-33SampleScriptsforAgentlessFIM-2.Appliance/LegacyUnixSSHLogin"><span>2. Appliance/Legacy Unix SSH Login</span></h2><p class="MsoNormal" style=""><span>Leave all settings at default then set Username and Password and adjust other settings where specified below:</span></p><p class="MsoNormal" style=""><span>Term Type: </span><span style="">TTY</span></p><p class="MsoNormal" style=""><span>Number of Columns</span><span style="">: 1024</span></p><p class="MsoNormal" style=""><span>Protocol: </span><span style="">SSH2</span><span> </span></p><p class="MsoNormal" style=""><span>New Line: <span style=""> </span></span><span style="">CRLF</span></p><p class="MsoNormal" style=""><span>Check </span><span style="">Send credentials with connect</span><span> (standard SSH setting)</span></p><p class="MsoNormal" style=""><span>Set prompt (e.g. </span><span style="">[root@localhost ~]#</span><span> )</span></p><p class="MsoNormal" style=""><span> </span></p><h3 class="MsoNormal" id="id-33SampleScriptsforAgentlessFIM-LoginScript:.1" style=""><span>Login Script:</span></h3><p class="MsoNormal" style=""><span style="">WaitForPrompt</span></p><p class="MsoNormal" style=""><span> </span></p><p><span>To execute a command and capture the result immediately after receiving the prompt, add:</span></p><h3 class="MsoNormal" id="id-33SampleScriptsforAgentlessFIM-MainScript:.1" style=""><span>Main Script:</span></h3><p class="MsoNormal"><span style="">ExecuteAndCapture,$$RESULT$$,ls -l /etc</span></p><h2 id="id-33SampleScriptsforAgentlessFIM-2.a.LegacyUnixAgentlessFIM"><span>2.a. Legacy Unix Agentless FIM</span></h2><p class="MsoNormal" style=""><span>Leave all settings as above and set Username and Password and adjust other settings where specified below:</span></p><h3 class="MsoNormal" id="id-33SampleScriptsforAgentlessFIM-LoginScript:.2" style=""><span>Login Script:</span></h3><p class="MsoNormal" style=""><span style="">WaitForPrompt</span></p><p class="MsoNormal" style=""><span style="">FileHashPath,/usr/bin/</span></p><p class="MsoNormal" style=""><span> </span></p><p><span>To execute a command and capture the result immediately after receiving the prompt, add:</span><span> </span></p><h3 class="MsoNormal" id="id-33SampleScriptsforAgentlessFIM-MainScript:.2" style=""><span>Main Script:</span></h3><p class="MsoNormal" style=""><span style="">FileHashPath,/usr/bin/NNT_FILEHASH_LINUX_X64</span></p><p class="MsoNormal"><span style="">WaitForPrompt</span></p><p><em style=""><span style="font-size: 10.0pt;font-family: Calibri , sans-serif;"><br style=""> </span></em></p><p class="MsoNormal" style=""><em style=""><span> </span></em></p><h2 id="id-33SampleScriptsforAgentlessFIM-2.a.LegacyUnixAgentlessFIM**Bewaresimple,singlecharacterpromptssuchas#or$**"><span>2.a. Legacy Unix Agentless FIM ** Beware simple, single character prompts such as </span><span style="">#</span><span> or </span><span style="">$</span><span> **</span></h2><p class="MsoNormal" style=""><strong><em style=""><span>Note: On legacy systems such as AIX or Solaris, the prompt may be just a simple #. This is a risky prompt to use as the # is often used for formatting welcome banners etc. and therefore may provide the tracker with a false prompt, terminating the capture prematurely.</span></em></strong></p><p class="MsoNormal" style=""><strong><em style=""><span>In this instance use an alternative shell with a stronger prompt, for example, bash. This means you would set your prompt in the credential settings as bash-n# requiring the switch to the bash shell to be driven by the login script  see example below</span></em><span> </span></strong></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LdJt2&amp;d=%2Fa%2F4u000000LzXl%2Frmct.97NdeS7NFiteiCny4alZMb.iI5I6B1aNYdL4Hk&amp;asPdf=false"></img></span></p><p class="MsoNormal" style=""><br></p><h2 id="id-33SampleScriptsforAgentlessFIM-3.CiscoTelnetLogin">3. Cisco Telnet Login</h2><p>Leave all settings at default then set Username and Password and adjust other settings where specified below:</p><p>Term Type: TTY</p><p>Number of Columns: 1024</p><p>Protocol: Telnet</p><p>New Line:  CRLF</p><p>Un-check Send credentials with connect (standard Telnet setting)</p><p>Prompts: e.g.       PCI-Network-1600&gt;</p><p>            PCI-Network-1600#</p><h3 id="id-33SampleScriptsforAgentlessFIM-LoginScript:.3">Login Script:</h3><p>Send,$$USERNAME$$\n</p><p>Send,$$PASSWORD$$\n</p><p>Sleep,2</p><p># This is the Privilege mode, accessed via the en command and the password needed (Note: It is possible to configure the Cisco to require a username and password for the Privilege mode in case you need to allow for this)</p><p>Send,en\n</p><p>Sleep,2</p><p>Send,$$PASSWORD2$$\n</p><p>Sleep,2</p><p>Execute,terminal len 0</p><p>Sleep,2</p><h3 id="id-33SampleScriptsforAgentlessFIM-MainScript:.3">Main Script:</h3><p># Hash sensitive lines in output</p><p>HashMatchesWithComment,*** password hashed *** ,password</p><p>HashMatchesWithComment,*** enable secret hashed *** ,enable secret</p><p># Get running config</p><p class="MsoNormal" style="">ExecuteAndCapture,$$RESULTS$$,sh run</p><p class="MsoNormal" style=""><br></p><h2 id="id-33SampleScriptsforAgentlessFIM-4.WindowsAgentlessLogin">4. Windows Agentless Login</h2><p>Leave all settings at default then set Username and Password and adjust other settings where specified below:</p><p>Term Type: Unused/Default</p><p>Number of Columns: 1024</p><p>Protocol: Windows Logon</p><p>New Line:  CRLF</p><p>Check Send credentials with connect</p><p>Prompts: e.g.       C:\Windows\System32&gt;</p><p>        </p><h3 id="id-33SampleScriptsforAgentlessFIM-LoginScript:.4">Login Script:</h3><p>WaitForPrompt</p><p>Main Script  Example:</p><p>ExecuteAndCapture,$$RESULT$$,ipconfig</p><h2 id="id-33SampleScriptsforAgentlessFIM-4.aAgentlessWindowsFIM">4.a Agentless Windows FIM</h2><p>For Windows Agentless FIM, there are some additional requirements to enable connectivity and operation of the Agentless FIM scan, both for the NNT ProxyAgent service and the target server(s).</p><p>In order for Change Tracker to perform Agentless FIM on a remote Windows host the NNT ProxyAgent Windows Service will be required to be assigned appropriate credentials for access. There are two different scenarios to consider  using Domain accounts and Local Accounts.</p><p>In either case, the assignment of credentials is done the same way, using the Microsoft Windows Services console to enter the account username and password for the NNT Windows Service (Note: The default Network Service account uses the Computer Identity and its rights are too limited to provide the Agentless Windows function).</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LdKB9&amp;d=%2Fa%2F4u000000LzeR%2FlWPu7O_yPKIQpWhi5wAc3KD1F0d56kFt97Uls5gPxms&amp;asPdf=false"></img></span></p><p>Regardless of whether Domain or Local accounts are used, the account used will require Local Administrator rights for the monitored target server(s). In this example we have created a special User Account called AgentlessFIM and assigned it to the NNT Proxy Agent service being used to monitor a remote server.</p><p>The NNT.Filehash.exe binary will need to be deployed to the host, best practice is to create a Program Files folder C:\Program Files\NNT Change Tracker Suite\Filehash and place the Windows NNT.Filehash.exe within it.</p><p>The path for the NNT_FILEHASH binary needs to be specified within the Credentials Key Login Script used for the host using the attribute FileHashPath</p><p>e.g. Login Script:</p><p>WaitForPrompt</p><p>FileHashPath,C:\Program Files\NNT Change Tracker Suite\Filehash\ NNT.Filehash.exe</p><h2 id="id-33SampleScriptsforAgentlessFIM-4.aAgentlessWindowsFIMAdditionalNotes:">4.a Agentless Windows FIM Additional Notes:<strong><em> </em></strong></h2><p>The Agentless Windows FIM connection uses netbios operations for remote service control and windows named pipes for remote command execution, so can only be run from a Windows-based NNT ProxyAgent to a Windows server.</p><p>If connection problems are encountered, check that you are able to:</p><p>a)      establish a file share connection to the server from the host using the credentials e.g.</p><p class="MsoNormal" style=""><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LdK7D&amp;d=%2Fa%2F4u000000LzeW%2FWp2EVmud7Y_bHpIoOCcZg7tRjl1POjCByJmZqbMbuns&amp;asPdf=false"></img></span></p><p>a)      copy a file to the ADMIN$ share using File Explorer</p><p>b)      control service state remotely using sc.exe from the command prompt (e.g. successfully querying remote service state proves the point: sc \\servername query)</p><h2 id="id-33SampleScriptsforAgentlessFIM-4.aAgentlessWindowsFIMSecurityPolicy/GroupPolicyandFirewallRules">4.a Agentless Windows FIM Security Policy/Group Policy and Firewall Rules</h2><p>When using Local Accounts, the Local Security Policy entry</p><pre>Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options\</pre><pre>Network access: Sharing and security model for local accounts should be configured to Classic: Local users authenticate as themselves<br><br>See <a class="external-link" href="http://technet.microsoft.com/en-us/library/cc786449%28v=ws.10%29.aspx" target="_blank">http://technet.microsoft.com/en-us/library/cc786449%28v=ws.10%29.aspx</a> <br><br></pre><p><br></p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LdK6e&amp;d=%2Fa%2F4u000000LzMz%2FCQCiqsaLewtcooy0u0AxrcP4XydU_5AgxIYTs7F0oSg&amp;asPdf=false"></img></span></p><pre><br><br></pre><p>Firewall rules require TCP Port 139 NetBIOS over TCP/IP which is the classic file and printer sharing port used by Microsoft.</p><p class="MsoNormal" style=""><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="https://nwxcorp--c.na147.content.force.com/sfc/dist/version/download/?oid=00D7000000091pB&amp;ids=0684u00000LdK0g&amp;d=%2Fa%2F4u000000Lze8%2F7SQQCoLxvDfzIMJY1mE4B7Xh2IVsBAxhTIrGlrqiaVs&amp;asPdf=false"></img></span></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p><p class="MsoNormal" style=""><br></p>
</body>
</html>