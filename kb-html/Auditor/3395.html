<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error: &quot;Error saving AD history to database: ExecuteNonQuery requires an open and available Connection. The connection&#x27;s current state is closed.&quot;</title>
    <meta name="content_type" content="ct_legacy">
    <meta name="product" content="auditor">
    <meta name="ArticleCaseAttachCount" content="0">
    <meta name="ArticleCreatedById" content="00570000005NmamAAC">
    <meta name="ArticleCreatedDate" content="2020-03-31T17:47:07.000Z">
    <meta name="Article_Drafts_Folder__c" content="nan">
    <meta name="Article_Reviewer__c" content="nan">
    <meta name="Article_SME__c" content="nan">
    <meta name="Article_Version_Origin__c" content="nan">
    <meta name="Asana_Task_URL__c" content="nan">
    <meta name="AssignedById" content="nan">
    <meta name="AssignedToId" content="nan">
    <meta name="AssignmentDate" content="nan">
    <meta name="AssignmentDueDate" content="nan">
    <meta name="AssignmentNote" content="nan">
    <meta name="Case__c" content="nan">
    <meta name="Confidence_Level__c" content="nan">
    <meta name="CreatedById" content="00570000005NmamAAC">
    <meta name="CreatedDate" content="2023-05-08T09:49:35.000Z">
    <meta name="Draft_Status__c" content="nan">
    <meta name="FirstPublishedDate" content="2020-04-01T09:30:34.000Z">
    <meta name="IsLatestVersion" content="True">
    <meta name="KnowledgeArticleId" content="kA00g000000H9ZLCA0">
    <meta name="Knowledge_Article_ID__c" content="kA00g000000H9ZLCA0">
    <meta name="LastModifiedById" content="0054u000006gSmgAAE">
    <meta name="LastModifiedDate" content="2023-05-08T09:49:35.000Z">
    <meta name="LastPublishedDate" content="2020-04-01T09:30:34.000Z">
    <meta name="Meta_Description__c" content="1. Restart SQL server hosting the product database;
2. In case where a restart does not help perform
2.1. Logon with an account...  for Netwrix Auditor tasks">
    <meta name="Meta_Title__c" content="&amp;quot;Error saving AD history to database: ExecuteNonQuery&amp;quot;">
    <meta name="OwnerId" content="00570000005NmamAAC">
    <meta name="PublishStatus" content="Online">
    <meta name="RecordTypeId" content="0124u000000UUgLAAW">
    <meta name="UrlName" content="1242">
    <meta name="VersionNumber" content="1">
    <meta name="Website_URL__c" content="&lt;a href=&quot;https://helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA00g000000H9ZLCA0.html&quot; target=&quot;_blank&quot;&gt;Open in a new window&lt;/a&gt;">
</head>
<body>
    <h1>Error: &quot;Error saving AD history to database: ExecuteNonQuery requires an open and available Connection. The connection&#x27;s current state is closed.&quot;</h1>
    You get the following error in the summary email reports:
&quot;Error saving AD history to database: ExecuteNonQuery requires an open and available Connection. The connection&#39;s current state is closed.&quot;

<hr></hr>

Database corruption can cause the error above to be thrown during a product database upgrade.

Such corruption can
- go unnoticed in the database until the upgrade is attempted.
- be caused by the loss of connectivity or disk corruption on the storage device where the database resides.

<hr></hr>

In order resolve this issue please do the following:

1. Restart SQL server hosting the product database;
2. In case where a restart does not help perform the following steps on SQL Server:
2.1. Logon with an account that you are using for Netwrix Auditor tasks
2.2. Launch Microsoft SQL Server Management Studio
2.3. Open a Query window focused on the database.
2.4. Run the following SQL command against the product database: dbcc checkdb
2.5 Review and save to a file the results of the command to confirm database corruption due to consistency errors. A sample of the command output is:

CHECKDB found 0 allocation errors and 29 consistency errors in database &#39;&#39;.
repair_allow_data_loss is the minimum repair level for the errors found by DBCC CHECKDB (...).
DBCC execution completed. If DBCC printed error messages, contact your system administrator.

2.6. Open a ticket with Netwrix Tech Support and upload the command results as well as product log files - a zip of the %Netwrix Installation Folder%Active Drirectory AuditingTracing folder.
</body>
</html>